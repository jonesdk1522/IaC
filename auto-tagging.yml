Code:
  ZipFile:
    Fn::Sub:
      - |
        const AWS = require("aws-sdk");
        const ec2 = new AWS.EC2();

        const allowedAsgs = ["${AllowedASGProxy}", "${AllowedASGMailRelay}"];

        exports.handler = async (event) => {
          const instanceId = event.detail?.EC2InstanceId;
          const az = event.detail?.AvailabilityZone;
          const asgName = event.detail?.AutoScalingGroupName;

          if (!instanceId || !az || !asgName) {
            console.warn("Missing required fields");
            return;
          }

          if (!allowedAsgs.includes(asgName)) {
            console.log("Not an allowed ASG:", asgName);
            return;
          }

          const suffix = instanceId.slice(-8);
          const shortAZ = az.slice(-2);

          await ec2.createTags({
            Resources: [instanceId],
            Tags: [
              { Key: "Name", Value: "ec2-" + suffix },     // âœ… No backticks
              { Key: "AZ", Value: shortAZ }
            ]
          }).promise();

          console.log("Tagged instance:", instanceId);
        };
      - {
          AllowedASGProxy: !Ref AllowedASGProxy,
          AllowedASGMailRelay: !Ref AllowedASGMailRelay
        }
